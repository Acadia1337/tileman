server {
  listen 157.7.134.126:80;
  server_name tile.openstreetmap.jp tile.osm.jp *.tile.openstreetmap.jp *.tile.openstreetmap.org;

  root   /var/www;

  access_log  /var/log/nginx/tiles_access.log combined;
  error_log   /var/log/nginx/tiles_error.log info;

  location = /favicon.ico {
        log_not_found off;
        access_log off;
  }

  location = /robots.txt {
        allow all;
        log_not_found off;
        access_log off;
  }

  location / {
    root /var/www/tiles;
    try_files $uri $uri/ @tilecache;
  }

  location @tilecache {
    proxy_pass        http://tile.openstreetmap.org ;
    proxy_cache       tilecache;
    proxy_cache_key "$scheme$host$request_uri";
    proxy_cache_valid  200 302  300h;
    proxy_cache_valid  404      1m;
  }
}
