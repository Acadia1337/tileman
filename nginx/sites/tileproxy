server {
  listen 80;
  server_name tile tile.openstreetmap.jp a.tile.openstreetmap.jp b.tile.openstreetmap.jp *.tile.openstreetmap.org;
  root   /var/www;

  access_log  /var/log/nginx/tileproxy_access.log combined;
  error_log   /var/log/nginx/tileproxy_error.log info;

  location = /favicon.ico {
        log_not_found off;
        access_log off;
  }

  location = /robots.txt {
        allow all;
        log_not_found off;
        access_log off;
  }

  location / {
    set $x 0;
    set $y 0;
    set $z 0;
    set $minz 0;
    set $maxz 18;
    access_by_lua_file /etc/nginx/script/tilecheck.lua; 
    include tileproxy_params;
    proxy_pass http://openstreetmap_backend;
  }
}
